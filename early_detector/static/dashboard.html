<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Early Detector ‚Äî Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #111827;
            --bg-card: rgba(17, 24, 39, 0.7);
            --bg-card-hover: rgba(30, 41, 59, 0.8);
            --border: rgba(99, 102, 241, 0.15);
            --border-hover: rgba(99, 102, 241, 0.4);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --green: #10b981;
            --green-glow: rgba(16, 185, 129, 0.2);
            --red: #ef4444;
            --red-glow: rgba(239, 68, 68, 0.2);
            --yellow: #f59e0b;
            --cyan: #06b6d4;
            --purple: #a855f7;
            --gradient-1: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --gradient-2: linear-gradient(135deg, #06b6d4 0%, #10b981 100%);
            --gradient-3: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            --gradient-4: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Background effects */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(6, 182, 212, 0.04) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(168, 85, 247, 0.03) 0%, transparent 50%);
            z-index: 0;
            pointer-events: none;
        }

        .copy-icon {
            cursor: pointer;
            width: 14px;
            height: 14px;
            margin-left: 6px;
            opacity: 0.6;
            transition: opacity 0.2s;
            display: inline-block;
            vertical-align: middle;
        }

        .copy-icon:hover {
            opacity: 1;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 14, 23, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            background: var(--green-glow);
            color: var(--green);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.4;
            }
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .auto-refresh-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .toggle-switch {
            position: relative;
            width: 40px;
            height: 22px;
            background: var(--bg-secondary);
            border-radius: 11px;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            transition: transform 0.3s;
        }

        .toggle-switch.active::after {
            transform: translateX(18px);
        }

        .refresh-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-family: inherit;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .refresh-btn:hover {
            border-color: var(--accent);
            color: var(--text-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        /* Main layout */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1440px;
            margin: 0 auto;
            padding: 24px 32px;
        }

        /* Navigation Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
            width: fit-content;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-family: inherit;
        }

        .tab:hover {
            color: var(--text-secondary);
        }

        .tab.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 2px 8px var(--accent-glow);
        }

        /* Section */
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .kpi-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: 16px 16px 0 0;
        }

        .kpi-card:nth-child(1)::before {
            background: var(--gradient-1);
        }

        .kpi-card:nth-child(2)::before {
            background: var(--gradient-2);
        }

        .kpi-card:nth-child(3)::before {
            background: var(--gradient-4);
        }

        .kpi-card:nth-child(4)::before {
            background: var(--gradient-3);
        }

        .kpi-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .kpi-card:nth-child(1) .kpi-value {
            color: var(--accent);
        }

        .kpi-card:nth-child(2) .kpi-value {
            color: var(--green);
        }

        .kpi-card:nth-child(3) .kpi-value {
            color: var(--purple);
        }

        .kpi-card:nth-child(4) .kpi-value {
            color: var(--yellow);
        }

        .kpi-sub {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Cluster chips */
        .cluster-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .cluster-chip {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .cluster-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .cluster-icon.retail {
            background: rgba(99, 102, 241, 0.15);
        }

        .cluster-icon.sniper {
            background: rgba(245, 158, 11, 0.15);
        }

        .cluster-icon.insider {
            background: rgba(239, 68, 68, 0.15);
        }

        .cluster-icon.unknown {
            background: rgba(100, 116, 139, 0.15);
        }

        .cluster-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .cluster-count {
            font-size: 20px;
            font-weight: 700;
        }

        /* Tables */
        .table-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .table-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 16px;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto;
        }

        th {
            text-align: left;
            padding: 12px 16px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border);
            background: rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }


        td {
            padding: 12px 16px;
            font-size: 13px;
            color: var(--text-secondary);
            border-bottom: 1px solid rgba(99, 102, 241, 0.05);
        }

        tr:hover td {
            background: rgba(99, 102, 241, 0.03);
        }

        .token-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .token-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .token-address {
            font-size: 11px;
            color: var(--text-muted);
            font-family: monospace;
        }

        /* Buy Button */
        .buy-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            background: var(--gradient-2);
            color: white;
            border: none;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .buy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4);
        }

        /* Score badge */
        .score-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            font-family: monospace;
        }

        .score-high {
            background: var(--red-glow);
            color: var(--red);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .score-medium {
            background: rgba(245, 158, 11, 0.15);
            color: var(--yellow);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .score-low {
            background: rgba(100, 116, 139, 0.15);
            color: var(--text-muted);
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        /* Cluster label */
        .label {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .label-retail {
            background: rgba(99, 102, 241, 0.15);
            color: var(--accent);
        }

        .label-sniper {
            background: rgba(245, 158, 11, 0.15);
            color: var(--yellow);
        }

        .label-insider {
            background: rgba(239, 68, 68, 0.15);
            color: var(--red);
        }

        .label-unknown {
            background: rgba(100, 116, 139, 0.15);
            color: var(--text-muted);
        }

        /* Action buttons */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }

        .action-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .action-card:hover {
            border-color: var(--border-hover);
        }

        .action-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .action-card p {
            font-size: 13px;
            color: var(--text-muted);
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .analyst-btn {
            background: rgba(99, 102, 241, 0.1);
            color: var(--accent);
            border: 1px solid rgba(99, 102, 241, 0.3);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .analyst-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .action-btn {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn.primary {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 16px var(--accent-glow);
        }

        .action-btn.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 24px var(--accent-glow);
        }

        .action-btn.secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .action-btn.secondary:hover {
            border-color: var(--accent);
            background: rgba(99, 102, 241, 0.1);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            z-index: 200;
            animation: slideUp 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
        }

        .toast.success {
            background: rgba(16, 185, 129, 0.15);
            color: var(--green);
            border-color: rgba(16, 185, 129, 0.3);
        }

        /* Narrative Tags */
        .narrative-tag {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .narrative-ai {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .narrative-politics {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .narrative-animals {
            background: rgba(234, 179, 8, 0.2);
            color: #eab308;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        .narrative-culture {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .narrative-generic {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
            border: 1px solid rgba(156, 163, 175, 0.3);
        }

        .toast.info {
            background: rgba(99, 102, 241, 0.15);
        }

        .verdict-tag {
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .v-BUY {
            background: var(--green);
            color: white;
        }

        .v-WAIT {
            background: var(--yellow);
            color: white;
        }

        .v-AVOID {
            background: var(--red);
            color: white;
        }

        .row-buyable {
            background: rgba(16, 185, 129, 0.15) !important;
            box-shadow: inset 4px 0 0 var(--green);
        }

        .row-buyable:hover {
            background: rgba(16, 185, 129, 0.25) !important;
        }

        .hot-badge {
            background: var(--gradient-3);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 800;
            margin-left: 8px;
            animation: pulse-hot 2s infinite;
        }

        @keyframes pulse-hot {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
            }

            70% {
                box-shadow: 0 0 0 4px rgba(239, 68, 68, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .toast.error {
            background: rgba(239, 68, 68, 0.15);
            color: var(--red);
            border-color: rgba(239, 68, 68, 0.3);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 14px;
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .header {
                padding: 12px 16px;
            }

            .kpi-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        /* Number formatting helper */
        .mono {
            font-family: 'SF Mono', 'Cascadia Code', 'Consolas', monospace;
            font-size: 13px;
        }

        .positive {
            color: var(--green);
        }

        .negative {
            color: var(--red);
        }

        .last-update {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* AI Analyst UI */
        .analyst-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            background: rgba(168, 85, 247, 0.15);
            color: var(--purple);
            border: none;
        }

        .analyst-btn:hover {
            background: rgba(168, 85, 247, 0.25);
        }

        /* Analytics Grid */
        .analytics-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .heatmap-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            min-height: 400px;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin-top: 16px;
        }

        .heat-cell {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
            aspect-ratio: 1;
        }

        .heat-cell:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .heat-symbol {
            font-weight: 800;
            font-size: 15px;
            margin-bottom: 2px;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .heat-address {
            font-size: 8px;
            font-family: monospace;
            opacity: 0.6;
            margin-bottom: 6px;
            background: rgba(0, 0, 0, 0.2);
            padding: 1px 4px;
            border-radius: 3px;
        }

        .heat-val {
            font-size: 10px;
            font-weight: 600;
            opacity: 0.9;
        }

        /* Explosive List */
        .explosive-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .explosive-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border-left: 3px solid var(--accent);
        }

        .analyst-btn:hover {
            background: rgba(168, 85, 247, 0.25);
            border-color: var(--purple);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            width: 100%;
            max-width: 500px;
            border-radius: 24px;
            padding: 32px;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5), 0 0 20px var(--accent-glow);
            animation: modalScale 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes modalScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
        }

        .verdict-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .verdict-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--text-primary);
        }

        .verdict-badge {
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 800;
            text-transform: uppercase;
        }

        .v-BUY {
            background: var(--green);
            color: white;
            box-shadow: 0 4px 12px var(--green-glow);
        }

        .v-AVOID {
            background: var(--red);
            color: white;
            box-shadow: 0 4px 12px var(--red-glow);
        }

        .v-WAIT {
            background: var(--yellow);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .analysis-section {
            margin-bottom: 20px;
        }

        .analysis-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .analysis-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .risk-list {
            list-style: none;
        }

        .risk-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .risk-item::before {
            content: '‚ö†Ô∏è';
            font-size: 12px;
        }

        .rating-bar {
            height: 6px;
            background: var(--bg-primary);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        .rating-progress {
            height: 100%;
            border-radius: 3px;
            transition: width 1s ease-out;
        }
    </style>
</head>

<body>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">üîÆ Solana Detector</div>
            <div class="status-badge">
                <span class="status-dot"></span>
                <span id="lastUpdate">Connecting‚Ä¶</span>
            </div>
        </div>
        <div class="header-right">
            <div id="solPriceBadge"
                style="background:var(--bg-card); border:1px solid var(--border); padding:4px 12px; border-radius:8px; font-size:12px; font-family:monospace; display:flex; align-items:center; gap:8px;">
                <span style="color:var(--text-muted)">SOL:</span>
                <span id="solPriceText" style="color:var(--green); font-weight:700;">$0.00</span>
            </div>
            <div class="wallet-balance" id="walletBalance"
                style="display:flex;align-items:center;gap:8px;padding:6px 14px;background:rgba(99,102,241,0.1);border:1px solid var(--border);border-radius:10px;font-size:13px;color:var(--text-secondary);">
                üí∞ <span id="solBalance">‚Äî</span> SOL
            </div>
            <div class="auto-refresh-toggle">
                <span>Auto-refresh</span>
                <div class="toggle-switch active" id="autoRefreshToggle" onclick="toggleAutoRefresh()"></div>
            </div>
            <button class="refresh-btn" onclick="refreshAll()">
                üîÑ Refresh
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview')">üìä Overview</button>
            <button class="tab" onclick="switchTab('signals')">‚ö° Signals</button>
            <button class="tab" onclick="switchTab('positions')">üí∞ Positions</button>
            <button class="tab" onclick="switchTab('tokens')">ü™ô Tokens</button>
            <button class="tab" onclick="switchTab('wallets')">üëõ Wallets</button>
            <button class="tab" onclick="switchTab('actions')">‚öôÔ∏è Actions</button>
            <button class="tab" id="tab-analytics" onclick="switchTab('analytics')">üìà Analytics</button>
        </div>

        <!-- SEARCH / FILTER FLOATING (Quick Navigation) -->
        <div style="margin-bottom: 24px; display: flex; gap: 12px; align-items: center;">
            <input type="text" id="tokenSearch" placeholder="üîç Search address or symbol..." oninput="filterAllTables()"
                style="flex:1; background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 12px 20px; color: var(--text-primary); outline: none;">
            <div class="tabs" style="margin-bottom: 0;">
                <button class="tab active filter-tab" id="btn-top-only" onclick="toggleTopOnly()">üíé Top Picks
                    Only</button>
                <button class="tab filter-tab" id="btn-show-all" onclick="toggleShowAll()">üåé All Tokens</button>
            </div>
        </div>

        <!-- OVERVIEW SECTION -->
        <div class="section active" id="section-overview">

            <!-- TOP PICKS GRID -->
            <div id="topPicksContainer" style="margin-bottom: 32px; display: none;">
                <h2
                    style="font-size: 20px; font-weight: 800; margin-bottom: 16px; display: flex; align-items: center; gap: 10px;">
                    üíé <span
                        style="background: var(--gradient-2); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">Top
                        Opportunities</span>
                </h2>
                <div class="kpi-grid" id="topPicksGrid"
                    style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                    <!-- Top Picks cards injected here -->
                </div>
            </div>

            <div class="kpi-grid" id="kpiGrid">
                <div class="kpi-card">
                    <div class="kpi-label">Tokens Tracked</div>
                    <div class="kpi-value" id="kpiTokens">‚Äî</div>
                    <div class="kpi-sub">Active tokens in DB</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Wallets Profiled</div>
                    <div class="kpi-value" id="kpiWallets">‚Äî</div>
                    <div class="kpi-sub" id="kpiSmartSub">Loading‚Ä¶</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Smart Wallets</div>
                    <div class="kpi-value" id="kpiSmart">‚Äî</div>
                    <div class="kpi-sub">ROI > 1.1x, WR > 25%</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Signals Generated</div>
                    <div class="kpi-value" id="kpiSignals">‚Äî</div>
                    <div class="kpi-sub">Total alerts triggered</div>
                </div>
            </div>

            <div class="cluster-grid" id="clusterGrid"></div>

            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">üïê Last Cycle Info</div>
                    <div class="last-update" id="cycleTime">‚Äî</div>
                </div>
                <div style="padding: 20px; color: var(--text-secondary); font-size: 14px;" id="cycleInfo">
                    Loading cycle data‚Ä¶
                </div>
            </div>
        </div>

        <!-- SIGNALS SECTION -->
        <div class="section" id="section-signals">
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">‚ö° Detected Signals</div>
                    <div style="display:flex; gap:12px; align-items:center;">
                        <div class="last-update" id="signalsCount">‚Äî</div>
                        <button class="refresh-btn" id="refreshSignalsBtn" onclick="refreshSignalsRecent()"
                            style="padding:6px 12px; font-size:12px;">
                            üîÑ Refresh Recent
                        </button>
                        <div class="last-update" id="signalsLastUpdate">Last update: ‚Äî</div>
                    </div>
                </div>
                <div id="signalsContent">
                    <table>
                        <thead>
                            <tr>
                                <th>Token</th>
                                <th>Scores (II / Degen)</th>
                                <th>Price</th>
                                <th>Market (Liq / Mcap)</th>
                                <th>Risk (Ins. / Cr. PSI / Top10)</th>
                                <th>Sizing (Win / Size)</th>
                                <th>Time</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="signalsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- POSITIONS SECTION -->
        <div class="section" id="section-positions">
            <div class="kpi-grid" style="margin-bottom:20px;">
                <div class="kpi-card">
                    <div class="kpi-label">Open Positions</div>
                    <div class="kpi-value" id="kpiOpenTrades">0</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Wallet Balance</div>
                    <div class="kpi-value" id="kpiWalletBal">‚Äî SOL</div>
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">üí∞ Open Positions</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Token</th>
                            <th>Invested</th>
                            <th>Entry Price</th>
                            <th>Current Price</th>
                            <th>ROI</th>
                            <th>TP</th>
                            <th>SL</th>
                            <th>Opened</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="positionsTable"></tbody>
                </table>
            </div>
            <div class="table-container" style="margin-top:20px;">
                <div class="table-header">
                    <div class="table-title">üìú Trade History</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Token</th>
                            <th>Invested</th>
                            <th>Entry</th>
                            <th>Exit</th>
                            <th>ROI</th>
                            <th>Outcome</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="historyTable"></tbody>
                </table>
            </div>
        </div>

        <!-- TOKENS SECTION -->
        <div class="section" id="section-tokens">
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">ü™ô Tracked Tokens</div>
                    <div class="last-update" id="tokensCount">‚Äî</div>
                </div>
                <div id="tokensContent">
                    <table>
                        <thead>
                            <tr>
                                <th>Token</th>
                                <th>Scores (II / AI)</th>
                                <th>Price</th>
                                <th>Market (Liq / Mcap)</th>
                                <th>Activity (Vol 5m / B/S)</th>
                                <th>Holders (Tot / Top10)</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="tokensTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- WALLETS SECTION -->
        <div class="section" id="section-wallets">
            <div class="table-container">
                <div class="table-header">
                    <div class="table-title">üëõ Wallet Performance</div>
                    <div class="last-update" id="walletsCount">‚Äî</div>
                </div>
                <div id="walletsContent">
                    <table>
                        <thead>
                            <tr>
                                <th>Wallet</th>
                                <th>Avg ROI</th>
                                <th>Total Trades</th>
                                <th>Win Rate</th>
                                <th>Cluster</th>
                                <th>Last Active</th>
                            </tr>
                        </thead>
                        <tbody id="walletsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ACTIONS SECTION -->
        <div class="section" id="section-actions">
            <div class="actions-grid">
                <div class="action-card">
                    <h3>üå± Seed Wallets</h3>
                    <p>Analyze trending Solana tokens and populate the wallet_performance table with fresh data from
                        Helius.</p>
                    <button class="action-btn primary" id="seedBtn" onclick="runAction('seed-wallets', this)">
                        üöÄ Run Seed Script
                    </button>
                </div>
                <div class="action-card">
                    <h3>üîÑ Refresh Smart Wallets</h3>
                    <p>Re-query the database to update the smart wallet list based on current performance criteria.</p>
                    <button class="action-btn secondary" id="refreshWalletsBtn"
                        onclick="runAction('refresh-wallets', this)">
                        üß† Refresh Wallet List
                    </button>
                </div>
                <div class="action-card">
                    <h3>üìä Refresh Dashboard</h3>
                    <p>Reload all dashboard data from the database. Also triggered automatically every 30 seconds when
                        auto-refresh is on.</p>
                    <button class="action-btn secondary" onclick="refreshAll()">
                        üîÑ Reload Now
                    </button>
                </div>
            </div>
        </div>

        <!-- ANALYTICS SECTION -->
        <div class="section" id="section-analytics">
            <div class="analytics-container">
                <div class="heatmap-card">
                    <div class="table-header" style="border:none; padding:0 0 16px 0;">
                        <div class="table-title">üî• Market Instability Heatmap</div>
                        <div class="last-update" id="heatmapTime">Real-time</div>
                    </div>
                    <div class="heatmap-legend"
                        style="display:flex; gap:16px; margin-bottom:16px; font-size:11px; color:var(--text-muted); padding:8px; background:rgba(255,255,255,0.02); border-radius:8px;">
                        <div style="display:flex; align-items:center; gap:6px;"><span
                                style="width:12px; height:12px; background:var(--green); border-radius:3px;"></span>
                            Best (Stable)</div>
                        <div style="display:flex; align-items:center; gap:6px;"><span
                                style="width:12px; height:12px; background:rgba(99, 102, 241, 0.4); border-radius:3px;"></span>
                            Normal</div>
                        <div style="display:flex; align-items:center; gap:6px;"><span
                                style="width:12px; height:12px; background:rgba(245, 158, 11, 0.6); border-radius:3px;"></span>
                            Moderate</div>
                        <div style="display:flex; align-items:center; gap:6px;"><span
                                style="width:12px; height:12px; background:var(--red); border-radius:3px;"></span> High
                            Instability</div>
                    </div>
                    <div class="heatmap-grid" id="heatmapGrid">
                        <!-- Heat cells injected here -->
                    </div>
                </div>

                <div style="display: flex; flex-direction: column; gap: 24px;">
                    <div class="kpi-card" style="margin-bottom:0;">
                        <div class="kpi-label">Narrative Dominance</div>
                        <div id="narrativeContainer" style="margin-top: 10px;">
                            <!-- Narratives injected here -->
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <div class="table-title">üìà Explosive Volume</div>
                        </div>
                        <div class="explosive-list" id="explosiveList" style="padding: 12px;">
                            <!-- Explosive items injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Analyst Modal -->
    <div class="modal-overlay" id="analystModal" onclick="if(event.target === this) closeAnalyst()">
        <div class="modal">
            <button class="modal-close" onclick="closeAnalyst()">&times;</button>
            <div class="verdict-header">
                <div class="verdict-title" id="analystTokenName">Analysing...</div>
                <div id="analystVerdict" class="verdict-badge">---</div>
            </div>

            <div class="analysis-section">
                <div class="analysis-label">AI Degen Score</div>
                <div class="kpi-value" id="analystScore" style="font-size: 40px;">0</div>
                <div class="rating-bar">
                    <div class="rating-progress" id="analystProgress"></div>
                </div>
            </div>

            <div class="analysis-section">
                <div class="analysis-label">Verdict Summary</div>
                <div class="analysis-text" id="analystSummary">...</div>
            </div>

            <div class="analysis-section">
                <div class="analysis-label">Top Risks</div>
                <ul class="risk-list" id="analystRisks"></ul>
            </div>

            <button class="action-btn primary" id="analystBuyBtn" onclick="" style="margin-top: 20px;">
                ‚ö° Execute Buy via PumpPortal
            </button>
        </div>
    </div>

    <!-- TRADE MODAL -->
    <div class="modal-overlay" id="tradeModal" style="display:none;"
        onclick="if(event.target === this) closeTradeModal()">
        <div class="modal" style="max-width:420px;">
            <button class="modal-close" onclick="closeTradeModal()">&times;</button>
            <div class="verdict-header" style="margin-bottom:16px;">
                <div class="verdict-title">üü¢ BUY <span id="tradeTokenName">TOKEN</span></div>
            </div>
            <input type="hidden" id="tradeTokenAddr">
            <div style="display:grid;gap:12px;">
                <div>
                    <label style="color:var(--text-secondary);font-size:12px;display:block;margin-bottom:4px;">Amount
                        (SOL)</label>
                    <input type="number" id="tradeAmount" value="0.1" min="0.001" step="0.01"
                        style="width:100%;padding:10px;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:16px;">
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                    <div>
                        <label style="color:var(--text-secondary);font-size:12px;display:block;margin-bottom:4px;">Take
                            Profit (%)</label>
                        <input type="number" id="tradeTp" value="50" min="1" step="5"
                            style="width:100%;padding:10px;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--green);font-size:14px;">
                    </div>
                    <div>
                        <label style="color:var(--text-secondary);font-size:12px;display:block;margin-bottom:4px;">Stop
                            Loss (%)</label>
                        <input type="number" id="tradeSl" value="30" min="1" step="5"
                            style="width:100%;padding:10px;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--red);font-size:14px;">
                    </div>
                </div>
                <div>
                    <label style="color:var(--text-secondary);font-size:12px;display:block;margin-bottom:4px;">Slippage
                        (BPS) ‚Äî 100 = 1%</label>
                    <input type="number" id="tradeSlippage" value="200" min="50" step="50"
                        style="width:100%;padding:10px;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;">
                </div>
                <button id="executeBuyBtn" onclick="executeBuyFromModal()"
                    style="padding:14px;background:var(--green);color:#000;border:none;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;transition:all 0.2s;">
                    üü¢ CONFERMA BUY
                </button>
                <div id="tradeStatus" style="text-align:center;font-size:13px;min-height:20px;"></div>
            </div>
        </div>
    </div>

    <script>
        // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let autoRefresh = true;
        let refreshInterval = null;
        let activeTab = 'overview';
        let solPriceUsd = 0;

        // ‚îÄ‚îÄ Tab Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function switchTab(tabName) {
            // Update buttons (only main navigation tabs, not filters)
            const buttons = Array.from(document.querySelectorAll('.tab:not(.filter-tab)'));
            buttons.forEach(b => b.classList.remove('active'));
            const targetBtn = buttons.find(b => b.textContent.toLowerCase().includes(tabName));
            if (targetBtn) targetBtn.classList.add('active');

            // Special case for analytics button since I added an ID
            if (tabName === 'analytics') {
                document.getElementById('tab-analytics').classList.add('active');
            }

            // Update sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            const section = document.getElementById(`section-${tabName}`);
            if (section) section.classList.add('active');

            activeTab = tabName;

            // Refresh logic handled by refreshAll
            refreshAll();
        }

        // ‚îÄ‚îÄ Auto Refresh ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const toggle = document.getElementById('autoRefreshToggle');
            toggle.classList.toggle('active', autoRefresh);
            if (autoRefresh) {
                startAutoRefresh();
            } else {
                clearInterval(refreshInterval);
            }
        }

        function startAutoRefresh() {
            clearInterval(refreshInterval);
            refreshInterval = setInterval(refreshAll, 10000); // 10s to drastically reduce Supabase network traffic
        }

        // Filtering state
        let showTopOnly = true;

        function toggleTopOnly() {
            showTopOnly = true;
            document.getElementById('btn-top-only').classList.add('active');
            document.getElementById('btn-show-all').classList.remove('active');
            refreshAll();
        }

        function toggleShowAll() {
            showTopOnly = false;
            document.getElementById('btn-show-all').classList.add('active');
            document.getElementById('btn-top-only').classList.remove('active');
            refreshAll();
        }

        function filterAllTables() {
            const query = document.getElementById('tokenSearch').value.toLowerCase().trim();

            // 1. Filter Table Rows
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const searchAttr = (row.getAttribute('data-search') || '').toLowerCase();
                row.style.display = (text.includes(query) || searchAttr.includes(query)) ? '' : 'none';
            });

            // 2. Filter Heatmap Cells (.heat-cell)
            const heatCells = document.querySelectorAll('.heat-cell');
            heatCells.forEach(cell => {
                const searchAttr = (cell.getAttribute('data-search') || '').toLowerCase();
                const symbol = cell.querySelector('.heat-symbol')?.textContent.toLowerCase() || '';
                cell.style.display = (searchAttr.includes(query) || symbol.includes(query)) ? '' : 'none';
            });

            // 3. Filter KPI Cards inside grids (like Top Picks)
            const kpiCards = document.querySelectorAll('#topPicksGrid .kpi-card');
            kpiCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query) ? '' : 'none';
            });
        }

        // ‚îÄ‚îÄ Data Loading ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

        function renderSignalRow(s) {
            const displayName = s.token_symbol === "???" ? s.token_address.slice(0, 4) : s.token_symbol;
            // Enhanced buy logic
            const isBuyable = s.confidence >= 0.70 || (s.instability_index > 1000 && s.confidence > 0.60) || s.degen_score > 70;
            const hotBadge = isBuyable ? '<span class="hot-badge">üî• HOT</span>' : '';
            return `
            <tr class="${isBuyable ? 'row-buyable' : ''}" data-search="${s.token_address} ${displayName}" 
                style="cursor:pointer" onclick="if(!event.target.closest('button') && !event.target.closest('svg')) showAiModal(${JSON.stringify(s).replace(/"/g, '&quot;')})">
                <td>
                    <div class="token-info">
                        <div style="display:flex; align-items:center;">
                            <span class="token-name" style="font-size:15px; font-weight:700; color:var(--text-primary);">${displayName}</span>
                            ${hotBadge}
                        </div>
                        <span class="token-address" style="margin-top:2px;">
                            ${s.token_address.slice(0, 6)}‚Ä¶
                            <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" onclick="copyToClipboard('${s.token_address}')">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </span>
                    </div>
                </td>
                <td>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <span class="score-badge ${getScoreClass(s.instability_index)}" style="font-size:11px;">II: ${s.instability_index.toFixed(2)}</span>
                        <div style="font-weight:800; color:${s.degen_score > 70 ? 'var(--green)' : s.degen_score > 40 ? 'var(--yellow)' : 'var(--red)'}; font-size:14px; background:rgba(255,255,255,0.05); padding:2px 6px; border-radius:4px;">
                            Degen: ${s.degen_score || '??'}
                        </div>
                    </div>
                </td>
                <td class="mono">
                    <div style="font-weight:600; color:var(--text-primary);">$${formatNum(s.entry_price)}</div>
                    <div style="font-size:10px; color:var(--text-muted)">
                        ${solPriceUsd > 0 ? (s.entry_price / solPriceUsd).toFixed(9) + ' SOL' : '‚Äî'}
                    </div>
                </td>
                <td class="mono">
                    <div style="color:var(--text-primary); margin-bottom:2px;">$${formatNum(s.liquidity)} <span style="font-size:10px;color:var(--text-muted)">Liq</span></div>
                    <div style="color:var(--text-secondary)">$${formatNum(s.marketcap)} <span style="font-size:10px;color:var(--text-muted)">MCap</span></div>
                </td>
                <td class="mono">
                    <div style="color:${s.insider_psi > 0.5 ? 'var(--red)' : 'var(--text-secondary)'}; margin-bottom:2px;">${(s.insider_psi).toFixed(2)} <span style="font-size:10px;color:var(--text-muted)">Ins.</span> | <span style="color:${s.creator_risk > 0.5 ? 'var(--red)' : 'var(--text-secondary)'};">${(s.creator_risk || 0).toFixed(2)}</span> <span style="font-size:10px;color:var(--text-muted)">Cr. PSI</span></div>
                    <div style="color:var(--yellow)">${(s.top10_ratio || 0).toFixed(1)}% <span style="font-size:10px;color:var(--text-muted)">Top10</span></div>
                </td>
                <td class="mono">
                    <div style="color:var(--green); margin-bottom:2px;">${(s.confidence * 100).toFixed(0)}% <span style="font-size:10px;color:var(--text-muted)">Win</span></div>
                    <div style="color:var(--accent)">${(s.kelly_size * 100).toFixed(1)}% <span style="font-size:10px;color:var(--text-muted)">Size</span></div>
                </td>
                <td class="last-update">${formatTime(s.timestamp)}</td>
                <td>
                    <div style="display:flex;gap:4px;flex-direction:column;">
                        <button class="buy-btn" onclick="openTradeModal('${s.token_address}', '${displayName}')">üü¢ BUY</button>
                        <button class="buy-btn" style="background:var(--red);font-size:10px;padding:4px 8px;" onclick="executeQuickSell('${s.token_address}', '${displayName}')">üî¥ SELL</button>
                    </div>
                </td>
            </tr>
            `;
        }

        async function fetchAPI(endpoint) {
            try {
                const resp = await fetch(endpoint);
                return await resp.json();
            } catch (e) {
                console.error(`API error: ${endpoint}`, e);
                return null;
            }
        }

        async function loadOverview() {
            const data = await fetchAPI('/api/overview');
            if (!data) return;

            document.getElementById('kpiTokens').textContent = data.tokens_tracked.toLocaleString();
            document.getElementById('kpiWallets').textContent = data.wallets_profiled.toLocaleString();
            document.getElementById('kpiSmart').textContent = data.smart_wallets.toLocaleString();
            document.getElementById('kpiSignals').textContent = data.total_signals.toLocaleString();
            document.getElementById('kpiSmartSub').textContent =
                `${data.smart_wallets} smart wallets detected`;

            // Last cycle
            if (data.last_cycle) {
                const dt = new Date(data.last_cycle);
                document.getElementById('cycleTime').textContent = dt.toLocaleString();
                document.getElementById('cycleInfo').textContent =
                    `Last data recorded: ${dt.toLocaleString()}`;
            }

            // Clusters
            const clusterGrid = document.getElementById('clusterGrid');
            const icons = { retail: 'üë§', sniper: 'üéØ', insider: 'üî•', unknown: '‚ùì' };
            clusterGrid.innerHTML = Object.entries(data.clusters || {}).map(([label, count]) => `
            <div class="cluster-chip">
                <div class="cluster-icon ${label}">${icons[label] || '‚ùì'}</div>
                <div>
                    <div class="cluster-label">${label.charAt(0).toUpperCase() + label.slice(1)}</div>
                    <div class="cluster-count">${count}</div>
                </div>
            </div>
        `).join('');

            // Update header
            document.getElementById('lastUpdate').innerHTML =
                `<span style="color:var(--green); font-weight:800;">LIVE</span> ‚Äî ${new Date().toLocaleTimeString()}`;
        }

        async function loadSignals() {
            const data = await fetchAPI('/api/signals');
            if (!data) return;

            const tbody = document.getElementById('signalsTable');

            // Filter data if showTopOnly is true
            let filteredSignals = data.signals;
            if (showTopOnly) {
                filteredSignals = data.signals.filter(s => (s.degen_score >= 50 || s.instability_index > 1.5));
            }

            document.getElementById('signalsCount').textContent =
                `${filteredSignals.length} signal(s) ${showTopOnly ? '(Top Rated)' : ''}`;

            if (filteredSignals.length === 0) {
                tbody.innerHTML = `
                <tr><td colspan="12">
                    <div class="empty-state">
                        <div class="icon">üîç</div>
                        <h3>No signals match filters</h3>
                        <p>${showTopOnly ? 'Try switching to "All Tokens" or wait for high-confidence entries.' : 'The bot needs more cycles to detect anomalies.'}</p>
                    </div>
                </td></tr>`;
                return;
            }

            // Update Top Picks in Overview
            const topSignals = data.signals.filter(s => (s.degen_score >= 50 || s.instability_index > 1.5));
            renderTopPicks(topSignals);

            tbody.innerHTML = filteredSignals.map(renderSignalRow).join('');
        }

        async function refreshSignalsRecent() {
            const btn = document.getElementById('refreshSignalsBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Refreshing...';

            try {
                const data = await fetchAPI('/api/signals/recent?minutes=10');
                if (!data) {
                    showToast('Failed to load recent signals', 'error');
                    return;
                }

                const tbody = document.getElementById('signalsTable');

                // Filter data if showTopOnly is true
                let filteredSignals = data.signals;
                if (showTopOnly) {
                    filteredSignals = data.signals.filter(s => (s.degen_score >= 50 || s.instability_index > 1.5));
                }

                document.getElementById('signalsCount').textContent =
                    `${filteredSignals.length} signal(s) ${showTopOnly ? '(Top Rated)' : ''} (Last 10 min)`;

                if (filteredSignals.length === 0) {
                    tbody.innerHTML = `
                    <tr><td colspan="12">
                        <div class="empty-state">
                            <div class="icon">üîç</div>
                            <h3>No recent signals</h3>
                            <p>No signals generated in the last 10 minutes.</p>
                        </div>
                    </td></tr>`;
                    return;
                }

                // Update Top Picks in Overview
                const topSignals = data.signals.filter(s => (s.degen_score >= 50 || s.instability_index > 1.5));
                renderTopPicks(topSignals);

                tbody.innerHTML = filteredSignals.map(renderSignalRow).join('');

                // Update last update time
                document.getElementById('signalsLastUpdate').textContent = `Last update: ${new Date().toLocaleTimeString()}`;
                showToast('Recent signals loaded', 'success');
            } catch (e) {
                console.error('Error refreshing signals:', e);
                showToast('Error refreshing signals', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        async function loadTokens() {
            const data = await fetchAPI('/api/tokens');
            if (!data) return;

            const tbody = document.getElementById('tokensTable');
            document.getElementById('tokensCount').textContent =
                `${data.tokens.length} token(s)`;

            if (data.tokens.length === 0) {
                tbody.innerHTML = `
                <tr><td colspan="11">
                    <div class="empty-state">
                        <div class="icon">ü™ô</div>
                        <h3>No tokens tracked yet</h3>
                        <p>Start the bot to begin discovering tokens.</p>
                    </div>
                </td></tr>`;
                return;
            }

            tbody.innerHTML = data.tokens.map(t => {
                const displayName = t.symbol === "???" ? t.address.slice(0, 4) : t.symbol;
                const isBuyable = t.instability_index > 100.0 && t.liquidity > 5000 && t.marketcap < 1000000;
                const hotBadge = isBuyable ? '<span class="hot-badge">üî• HOT</span>' : '';
                return `
                <tr class="${isBuyable ? 'row-buyable' : ''}" data-search="${t.address} ${displayName}" 
                    style="cursor:pointer" onclick="if(!event.target.closest('button') && !event.target.closest('svg')) openAnalyst('${t.address}', '${displayName}')">
                    <td>
                        <div class="token-info">
                            <div style="display:flex; align-items:center;">
                                <span class="token-name" style="font-size:15px; font-weight:700; color:var(--text-primary);">${displayName}</span>
                                ${hotBadge}
                            </div>
                            <span class="token-address" style="margin-top:2px;">
                                ${t.address.slice(0, 6)}‚Ä¶
                                <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" onclick="copyToClipboard('${t.address}')">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                            </span>
                            <div style="margin-top:4px;"><span class="narrative-tag narrative-${(t.narrative || '').toLowerCase()}">${t.narrative || 'GENERIC'}</span></div>
                        </div>
                    </td>
                    <td>
                        <div style="display:flex; gap:8px; align-items:center;">
                            <span class="score-badge ${getScoreClass(t.instability_index)}" style="font-size:11px;">II: ${t.instability_index.toFixed(2)}</span>
                            <div style="font-weight:800; color:var(--text-muted); font-size:14px; background:rgba(255,255,255,0.05); padding:2px 6px; border-radius:4px; cursor:pointer;" onclick="openAnalyst('${t.address}', '${displayName}')">
                                ü§ñ AI
                            </div>
                        </div>
                    </td>
                    <td class="mono">
                        <div style="font-weight:600; color:var(--text-primary);">$${formatNum(t.price)}</div>
                        <div style="font-size:10px; color:var(--text-muted)">
                            ${solPriceUsd > 0 ? (t.price / solPriceUsd).toFixed(9) + ' SOL' : '‚Äî'}
                        </div>
                    </td>
                    <td class="mono">
                        <div style="color:var(--text-primary); margin-bottom:2px;">$${formatNum(t.liquidity)} <span style="font-size:10px;color:var(--text-muted)">Liq</span></div>
                        <div style="color:var(--text-secondary)">$${formatNum(t.marketcap)} <span style="font-size:10px;color:var(--text-muted)">MCap</span></div>
                    </td>
                    <td class="mono">
                        <div style="color:var(--text-primary); margin-bottom:2px;">$${formatNum(t.volume_5m)} <span style="font-size:10px;color:var(--text-muted)">Vol 5m</span></div>
                        <div style="font-size:11px;">
                            <span class="positive">${t.buys_5m} B</span> / <span class="negative">${t.sells_5m} S</span>
                        </div>
                    </td>
                    <td class="mono">
                        <div style="margin-bottom:2px;">${t.holders ? t.holders.toLocaleString() : '0'} <span style="font-size:10px;color:var(--text-muted)">Hold</span></div>
                        <div style="color:var(--accent)">${(t.top10_ratio || 0).toFixed(1)}% <span style="font-size:10px;color:var(--text-muted)">Top10</span></div>
                    </td>
                    <td>
                        <div style="display:flex;gap:4px;flex-direction:column;">
                            <button class="buy-btn" onclick="openTradeModal('${t.address}', '${displayName}')">üü¢ BUY</button>
                            <button class="buy-btn" style="background:var(--red);font-size:10px;padding:4px 8px;" onclick="executeQuickSell('${t.address}', '${displayName}')">üî¥ SELL</button>
                        </div>
                    </td>
                </tr>
            `}).join('');
        }

        async function loadWallets() {
            const data = await fetchAPI('/api/wallets');
            if (!data) return;

            const tbody = document.getElementById('walletsTable');
            document.getElementById('walletsCount').textContent =
                `${data.wallets.length} wallet(s)`;

            if (data.wallets.length === 0) {
                tbody.innerHTML = `
                <tr><td colspan="6">
                    <div class="empty-state">
                        <div class="icon">üëõ</div>
                        <h3>No wallets profiled</h3>
                        <p>Run the Seed Wallets action to populate wallet data.</p>
                    </div>
                </td></tr>`;
                return;
            }

            tbody.innerHTML = data.wallets.map(w => `
            <tr data-search="${w.wallet}">
                <td class="token-address">${w.wallet.slice(0, 8)}‚Ä¶${w.wallet.slice(-6)}</td>
                <td class="mono ${w.avg_roi > 1 ? 'positive' : 'negative'}">${w.avg_roi.toFixed(2)}x</td>
                <td class="mono">${w.total_trades}</td>
                <td class="mono">${(w.win_rate * 100).toFixed(1)}%</td>
                <td><span class="label label-${w.cluster_label}">${w.cluster_label}</span></td>
                <td class="last-update">${w.last_active ? formatTime(w.last_active) : '‚Äî'}</td>
            </tr>
        `).join('');
        }

        function showAiModal(signal) {
            const modal = document.getElementById('analystModal');
            modal.style.display = 'flex';

            document.getElementById('analystTokenName').textContent = `AI Analysis of ${signal.token_symbol}`;

            // If we have cached/stored analysis, show it immediately
            if (signal.ai_summary) {
                const verdict = signal.ai_analysis?.verdict || 'WAIT';
                document.getElementById('analystVerdict').textContent = verdict;
                document.getElementById('analystVerdict').className = `verdict-badge v-${verdict}`;
                document.getElementById('analystScore').textContent = signal.degen_score || '??';

                const scoreValue = signal.degen_score || 50;
                const scoreColor = scoreValue > 70 ? 'var(--green)' : scoreValue > 40 ? 'var(--yellow)' : 'var(--red)';
                document.getElementById('analystScore').style.color = scoreColor;
                document.getElementById('analystProgress').style.width = `${scoreValue}%`;
                document.getElementById('analystProgress').style.background = scoreColor;

                document.getElementById('analystSummary').textContent = signal.ai_summary;

                // Construct risk list from analysis object if possible
                let risks = signal.ai_analysis?.risks || [];
                document.getElementById('analystRisks').innerHTML = risks.map(r => `<li class="risk-item">${r}</li>`).join('');

                document.getElementById('analystBuyBtn').onclick = () => {
                    closeAnalyst();
                    openTradeModal(signal.token_address, signal.token_symbol);
                };
            } else {
                // Fallback to fetching it
                openAnalyst(signal.token_address, signal.token_symbol);
            }
        }

        // ‚îÄ‚îÄ AI Analyst ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function openAnalyst(address, symbol) {
            const modal = document.getElementById('analystModal');
            modal.style.display = 'flex';

            // Reset modal state
            document.getElementById('analystTokenName').textContent = `AI Analysis of ${symbol}`;
            document.getElementById('analystVerdict').textContent = 'WAIT';
            document.getElementById('analystVerdict').className = 'verdict-badge v-WAIT';
            document.getElementById('analystScore').textContent = '...';
            document.getElementById('analystProgress').style.width = '0%';
            document.getElementById('analystSummary').textContent = 'Scanning on-chain signals with Gemini 1.5 Flash...';
            document.getElementById('analystRisks').innerHTML = '';
            document.getElementById('analystBuyBtn').onclick = () => {
                closeAnalyst();
                openTradeModal(address, symbol);
            };

            const data = await fetchAPI(`/api/analyze/${address}`);
            if (!data) {
                showToast('Analysis failed', 'error');
                closeAnalyst();
                return;
            }

            // Update UI with AI results
            document.getElementById('analystVerdict').textContent = data.verdict;
            document.getElementById('analystVerdict').className = `verdict-badge v-${data.verdict}`;
            document.getElementById('analystScore').textContent = data.rating;

            const scoreColor = data.rating > 7 ? 'var(--green)' : data.rating > 4 ? 'var(--yellow)' : 'var(--red)';
            document.getElementById('analystScore').style.color = scoreColor;
            document.getElementById('analystProgress').style.width = `${data.rating * 10}%`;
            document.getElementById('analystProgress').style.background = scoreColor;

            document.getElementById('analystSummary').textContent = data.summary;
            document.getElementById('analystRisks').innerHTML = (data.risks || []).map(r => `
            <li class="risk-item">${r}</li>
        `).join('');
        }

        function closeAnalyst() {
            document.getElementById('analystModal').style.display = 'none';
        }

        // ‚îÄ‚îÄ Actions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function runAction(action, btn) {
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Running‚Ä¶';

            try {
                const resp = await fetch(`/api/actions/${action}`, { method: 'POST' });
                const data = await resp.json();
                showToast(data.message || `Action "${action}" completed`, 'success');
                setTimeout(refreshAll, 2000);
            } catch (e) {
                showToast(`Error running ${action}`, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // ‚îÄ‚îÄ Utilities ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function formatNum(n) {
            if (n === 0 || n === null || n === undefined) return '0.00';
            if (n >= 1e9) return (n / 1e9).toFixed(2) + 'B';
            if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
            if (n >= 1e3) return (n / 1e3).toFixed(2) + 'K';
            if (n >= 1) return n.toFixed(2);
            if (n >= 0.0001) return n.toFixed(4);
            if (n >= 0.0000000001) return n.toFixed(10).replace(/\.?0+$/, ""); // Trim trailing zeros
            return n.toExponential(2);
        }

        function formatTime(iso) {
            if (!iso) return '‚Äî';
            const d = new Date(iso);
            const now = new Date();
            const diff = (now - d) / 1000;
            if (diff < 60) return `${Math.floor(diff)}s ago`;
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return d.toLocaleDateString();
        }

        function getScoreClass(score) {
            if (score >= 3) return 'score-high';
            if (score >= 1) return 'score-medium';
            return 'score-low';
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                showToast('Address copied to clipboard', 'success');
            } catch (err) {
                console.error('Failed to copy: ', err);
                showToast('Failed to copy address', 'error');
            }
        }

        function analyzeToken(address) {
            // Find the symbol for the given address if needed, or pass a placeholder
            // For now, we'll just pass the address and let openAnalyst fetch details
            openAnalyst(address, 'Token');
        }

        // ‚îÄ‚îÄ Refresh All ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function refreshAll() {
            await Promise.all([
                loadOverview(),
                loadSignals(),
                loadTokens(),
                loadWallets(),
                loadPositions(),
                loadWalletBalance(),
                loadSolPrice(),
                fetchAnalytics(),
            ]);
            filterAllTables();
        }

        // ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // Initialize
        refreshAll();
        startAutoRefresh();

        // ‚îÄ‚îÄ Trading Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function openTradeModal(address, symbol) {
            const modal = document.getElementById('tradeModal');
            document.getElementById('tradeTokenAddr').value = address;
            document.getElementById('tradeTokenName').textContent = symbol;
            modal.style.display = 'flex';
        }

        function closeTradeModal() {
            document.getElementById('tradeModal').style.display = 'none';
        }

        async function executeBuyFromModal() {
            const address = document.getElementById('tradeTokenAddr').value;
            const amountSol = parseFloat(document.getElementById('tradeAmount').value);
            const tp = parseFloat(document.getElementById('tradeTp').value);
            const sl = parseFloat(document.getElementById('tradeSl').value);
            const slippage = parseInt(document.getElementById('tradeSlippage').value);
            const btn = document.getElementById('executeBuyBtn');
            const status = document.getElementById('tradeStatus');

            btn.disabled = true;
            btn.textContent = '‚è≥ Executing...';
            status.textContent = '';

            try {
                const resp = await fetch('/api/trade/buy', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address, amount_sol: amountSol, tp_pct: tp, sl_pct: sl, slippage_bps: slippage })
                });
                const data = await resp.json();
                if (data.success) {
                    status.innerHTML = `<span style="color:var(--green)">‚úÖ BUY completed! TX: ${data.tx_hash?.slice(0, 16)}...</span>`;
                    setTimeout(() => { closeTradeModal(); refreshAll(); }, 2000);
                } else {
                    status.innerHTML = `<span style="color:var(--red)">‚ùå ${data.error}</span>`;
                }
            } catch (e) {
                status.innerHTML = `<span style="color:var(--red)">‚ùå Error: ${e.message}</span>`;
            }
            btn.disabled = false;
            btn.textContent = 'üü¢ CONFIRM BUY';
        }

        async function manualSell(tradeId, address) {
            if (!confirm('Are you sure you want to sell this position?')) return;
            try {
                const resp = await fetch('/api/trade/sell', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address, trade_id: tradeId })
                });
                const data = await resp.json();
                if (data.success) {
                    showToast('‚úÖ SELL completed!', 'success');
                    refreshAll();
                } else {
                    showToast('‚ùå SELL failed: ' + data.error, 'error');
                }
            } catch (e) {
                showToast('‚ùå Error: ' + e.message, 'error');
            }
        }

        async function executeQuickSell(address, symbol) {
            if (!confirm(`Sei sicuro di voler vendere il 100% di ${symbol}?`)) return;
            showToast(`Vendita di ${symbol} in corso...`, 'info');
            try {
                const resp = await fetch('/api/trade/sell', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address })
                });
                const data = await resp.json();
                if (data.success) {
                    showToast(`‚úÖ ${symbol} venduto con successo!`, 'success');
                    refreshAll();
                } else {
                    showToast('‚ùå Errore: ' + data.error, 'error');
                }
            } catch (e) {
                showToast('‚ùå Errore di rete: ' + e.message, 'error');
            }
        }

        async function loadPositions() {
            const data = await fetchAPI('/api/trade/positions');
            const history = await fetchAPI('/api/trade/history');

            // Open positions
            const tbody = document.getElementById('positionsTable');
            const kpiOpen = document.getElementById('kpiOpenTrades');
            if (data && data.positions) {
                kpiOpen.textContent = data.positions.length;
                if (data.positions.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="9"><div class="empty-state"><div class="icon">üì≠</div><h3>No open positions</h3><p>Click BUY on a signal to open your first position.</p></div></td></tr>';
                } else {
                    tbody.innerHTML = data.positions.map(p => {
                        const roiColor = p.roi_pct >= 0 ? 'var(--green)' : 'var(--red)';
                        return `<tr data-search="${p.token_address} ${p.symbol}">
                            <td><div class="token-info"><span class="token-name">${p.symbol}</span><span class="token-address">${p.token_address.slice(0, 6)}‚Ä¶</span></div></td>
                            <td class="mono">${p.amount_sol.toFixed(3)} SOL</td>
                            <td class="mono">
                                <div>$${formatNum(p.price_entry)}</div>
                                <div style="font-size:10px; color:var(--text-muted)">
                                    ${solPriceUsd > 0 ? (p.price_entry / solPriceUsd).toFixed(9) : '‚Äî'}
                                </div>
                            </td>
                            <td class="mono">
                                <div>$${formatNum(p.current_price)}</div>
                                <div style="font-size:10px; color:var(--text-muted)">
                                    ${solPriceUsd > 0 ? (p.current_price / solPriceUsd).toFixed(9) : '‚Äî'}
                                </div>
                            </td>
                            <td class="mono" style="color:${roiColor};font-weight:700">${p.roi_pct >= 0 ? '+' : ''}${p.roi_pct.toFixed(1)}%</td>
                            <td class="mono" style="color:var(--green)">+${p.tp_pct}%</td>
                            <td class="mono" style="color:var(--red)">-${p.sl_pct}%</td>
                            <td class="last-update">${formatTime(p.created_at)}</td>
                            <td><button class="buy-btn" style="background:var(--red);" onclick="manualSell(${p.id}, '${p.token_address}')">üî¥ SELL</button></td>
                        </tr>`;
                    }).join('');
                }
            }

            // History
            const htbody = document.getElementById('historyTable');
            if (history && history.trades) {
                if (history.trades.length === 0) {
                    htbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><p>No completed trades.</p></div></td></tr>';
                } else {
                    htbody.innerHTML = history.trades.map(t => {
                        const statusIcon = t.status === 'TP_HIT' ? 'üéØ' : t.status === 'SL_HIT' ? 'üõë' : '‚úã';
                        const roiColor = t.roi_pct >= 0 ? 'var(--green)' : 'var(--red)';
                        return `<tr>
                            <td>${t.symbol}</td>
                            <td class="mono">${t.amount_sol.toFixed(3)} SOL</td>
                            <td class="mono">
                                <div>$${formatNum(t.price_entry)}</div>
                                <div style="font-size:10px; color:var(--text-muted)">
                                    ${solPriceUsd > 0 ? (t.price_entry / solPriceUsd).toFixed(9) : '‚Äî'}
                                </div>
                            </td>
                            <td class="mono">
                                <div>$${formatNum(t.price_exit)}</div>
                                <div style="font-size:10px; color:var(--text-muted)">
                                    ${solPriceUsd > 0 ? (t.price_exit / solPriceUsd).toFixed(9) : '‚Äî'}
                                </div>
                            </td>
                            <td class="mono" style="color:${roiColor};font-weight:700">${t.roi_pct >= 0 ? '+' : ''}${t.roi_pct.toFixed(1)}%</td>
                            <td>${statusIcon} ${t.status}</td>
                            <td class="last-update">${formatTime(t.closed_at)}</td>
                        </tr>`;
                    }).join('');
                }
            }
        }

        async function loadWalletBalance() {
            const data = await fetchAPI('/api/wallet/balance');
            if (data) {
                const bal = data.balance?.toFixed(5) || '0.00000';
                document.getElementById('solBalance').textContent = bal;
                const kpiBal = document.getElementById('kpiWalletBal');
                if (kpiBal) kpiBal.textContent = bal + ' SOL';
            }
        }

        function renderTopPicks(signals) {
            const container = document.getElementById('topPicksContainer');
            const grid = document.getElementById('topPicksGrid');

            // Focus on top 3 by score
            const top = [...signals]
                .sort((a, b) => b.degen_score - a.degen_score)
                .slice(0, 3);

            if (top.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            grid.innerHTML = top.map(s => {
                const displayName = s.token_symbol === "???" ? s.token_address.slice(0, 4) : s.token_symbol;
                const scoreColor = s.degen_score > 70 ? 'var(--green)' : 'var(--yellow)';

                return `
                    <div class="kpi-card" style="border: 2px solid ${scoreColor}; box-shadow: 0 0 20px rgba(16, 185, 129, 0.1);">
                        <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:12px;">
                            <div class="token-info">
                                <span class="token-name" style="font-size: 20px;">${displayName}</span>
                                <span class="token-address">${s.token_address.slice(0, 10)}...</span>
                            </div>
                            <div class="score-badge v-BUY" style="font-size: 14px; padding: 6px 12px;">SCORE: ${s.degen_score || '??'}</div>
                        </div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; font-size:13px; color:var(--text-secondary);">
                            <div>Market Cap: <b>$${formatNum(s.marketcap)}</b></div>
                            <div>Liquidity: <b>$${formatNum(s.liquidity)}</b></div>
                            <div>Instability: <b style="color:var(--accent)">${s.instability_index.toFixed(2)}</b></div>
                            <div>Confidence: <b style="color:var(--green)">${(s.confidence * 100).toFixed(0)}%</b></div>
                        </div>
                        <button class="action-btn primary" onclick="openTradeModal('${s.token_address}', '${displayName}')">
                            ‚ö° Quick Buy ${displayName}
                        </button>
                    </div>
                `;
            }).join('');
        }

        async function loadSolPrice() {
            const data = await fetchAPI('/api/trade/sol-price');
            if (data && data.price) {
                solPriceUsd = data.price;
                const el = document.getElementById('solPriceText');
                if (el) el.textContent = `$${data.price.toFixed(2)} `;
            }
        }

        // Analytics Logic
        async function fetchAnalytics() {
            try {
                const res = await fetch('/api/analytics');
                const data = await res.json();
                renderHeatmap(data.heatmap);
                renderExplosive(data.explosive_leaders);
                renderNarratives(data.narrative_stats);
            } catch (e) {
                console.error("Analytics error", e);
            }
        }

        function renderNarratives(stats) {
            const container = document.getElementById('narrativeContainer');
            if (!stats) return;

            // Sort by dominance
            const entries = Object.entries(stats).sort((a, b) => b[1].dominance - a[1].dominance);

            container.innerHTML = entries.map(([name, data]) => {
                const color = name === 'AI' ? 'var(--purple)' :
                    name === 'POLITICS' ? 'var(--red)' :
                        name === 'ANIMALS' ? 'var(--yellow)' :
                            name === 'GENERIC' ? 'var(--text-muted)' : 'var(--accent)';

                return `
                    <div style="margin-bottom: 8px;">
                        <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:4px;">
                            <span style="font-weight:600; color:${color}">${name}</span>
                            <span style="color:var(--text-secondary)">${data.dominance.toFixed(1)}%</span>
                        </div>
                        <div style="height:6px; background:rgba(255,255,255,0.05); border-radius:3px; overflow:hidden;">
                            <div style="height:100%; width:${data.dominance}%; background:${color}; border-radius:3px;"></div>
                        </div>
                        <div style="font-size:10px; color:var(--text-muted); margin-top:2px;">${data.count} tokens</div>
                    </div>
                `;
            }).join('');
        }

        function renderHeatmap(data) {
            const container = document.getElementById('heatmapGrid');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="empty-state">No data available</div>';
                return;
            }

            // Find the minimum instability to mark the "Best"
            const minII = Math.min(...data.map(d => d.instability_index));

            container.innerHTML = data.map(item => {
                const score = Math.min(Math.max(item.instability_index, 0), 100);

                let bg;
                let textCol = 'var(--text-primary)';

                if (item.instability_index === minII && score < 10) {
                    // THE BEST (Absolute lowest II and under threshold)
                    bg = 'var(--green)';
                    textCol = '#000';
                } else if (score > 50) {
                    // High Risk
                    const opacity = 0.4 + (score / 200);
                    bg = `rgba(239, 68, 68, ${opacity})`;
                    textCol = '#fff';
                } else if (score > 15) {
                    // Moderate
                    const opacity = 0.3 + (score / 150);
                    bg = `rgba(245, 158, 11, ${opacity})`;
                } else if (score > 5) {
                    // Normal
                    bg = `rgba(99, 102, 241, 0.3)`;
                } else {
                    // Stable/Good
                    bg = `rgba(16, 185, 129, 0.2)`;
                }

                return `
                    <div class="heat-cell" data-search="${item.address} ${item.symbol}" style="background: ${bg}" onclick="analyzeToken('${item.address}')">
                        <div class="heat-symbol" style="color: ${textCol}">${item.symbol}</div>
                        <div class="heat-address">${item.address.slice(0, 4)}...${item.address.slice(-4)}</div>
                        <div class="heat-val" style="color: ${textCol}">II: ${score.toFixed(1)}</div>
                        <div class="heat-val" style="font-size: 9px; opacity: 0.7; color: ${textCol}">Vol: $${formatNum(item.volume_5m)}</div>
                    </div>
                `;
            }).join('');
        }

        function renderExplosive(data) {
            const container = document.getElementById('explosiveList');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="empty-state" style="padding: 20px;">No data</div>';
                return;
            }

            container.innerHTML = data.map((item, idx) => `
                <div class="explosive-item" style="cursor:pointer; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.06)'" onmouseout="this.style.background='rgba(255,255,255,0.03)'" onclick="window.open('https://dexscreener.com/solana/${item.address}', '_blank')">
                    <div style="display:flex; gap:12px; align-items:center;">
                        <span style="font-weight:700; color:var(--accent); width:20px;">#${idx + 1}</span>
                        <div>
                            <div style="font-weight:600; font-size:13px; color:var(--text-primary);">${item.symbol}</div>
                             <div style="font-size:11px; color:var(--text-muted); cursor:pointer;" onclick="event.stopPropagation(); navigator.clipboard.writeText('${item.address}'); showToast('Address copied!', 'success')">${item.address.slice(0, 4)}...${item.address.slice(-4)}</div>
                        </div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-weight:700; color:var(--green);">${item.velocity.toFixed(1)}%</div>
                        <div style="font-size:10px; color:var(--text-muted);">Turnover</div>
                    </div>
                </div>
            `).join('');
        }
    </script>

</body>

</html>
```